/*!
 * JSudoku v1.0
 *
 * Autor: Kevin Gómez Codina
 * Date: 2022-03-07T07:58Z
 */
"use strict";!function(g){function e(e){if(!e)throw Error("JSudoku -> Es necesario proporcionar un contenedor DOM para inicializar el juego.");this.board=new Array(9),this.gameBoard=new Array(9),this.gameBoardChecked=0,this.gameOver=!1,this.timerInterval=void 0,this.timerStartDate=0,this.timerPauseDate=0,d.initContainer(this,e),this.newGame(1)}var d;g.JSudoku=(d={sudoku:void 0,container:void 0,table:void 0,tableValues:void 0,selectedCell:void 0,inputValue:void 0,timer:void 0,popup:{container:void 0,message:void 0},initContainer:function(e,t){this.container||(this.container=t,this.sudoku=e,t=g.document.createElement("div"),e=g.document.createElement("h1"),t.classList.add("title"),e.appendChild(g.document.createTextNode("JSudoku")),t.appendChild(e),this.container.classList.add("jsudoku"),this.container.appendChild(t),d.createMainMenu(),this.table=g.document.createElement("table"),this.container.appendChild(this.table),d.paintTableValues(),this.inputValue=g.document.createElement("input"),this.inputValue.setAttribute("type","text"),this.inputValue.setAttribute("inputmode","none"),this.inputValue.classList.add("hidden"),this.container.appendChild(this.inputValue),d.createPopup(),d.createSelectEvent(),d.createValueEvent())},createMainMenu:function(){var t=this;function e(e,t){var a=g.document.createElement("button");return a.innerText=e,"function"==typeof t&&a.addEventListener("click",t),a}var a,i,r,d,n,s,l=g.document.createElement("div");function o(e,t,a,i){var r=g.document.createElement("input");return r.setAttribute("id",e),r.setAttribute("type","radio"),r.setAttribute("name",t),r.setAttribute("value",a),i&&r.setAttribute("checked","checked"),r}function c(e,t){var a=g.document.createElement("label");return a.setAttribute("for",e),a.innerText=t,a}l.classList.add("main-menu"),l.appendChild((a=g.document.createElement("div"),d=g.document.createElement("div"),n=g.document.createElement("div"),s=g.document.createElement("div"),i=g.document.createElement("form"),r="easy_input",d.appendChild(o(r,"difficulty","0",!1)),d.appendChild(c(r,"Fácil")),r="normal_input",n.appendChild(o(r,"difficulty","1",!0)),n.appendChild(c(r,"Normal")),r="hard_input",s.appendChild(o(r,"difficulty","2",!1)),s.appendChild(c(r,"Difícil")),(r=g.document.createElement("input")).setAttribute("type","submit"),r.value="Nuevo",i.appendChild(d),i.appendChild(n),i.appendChild(s),i.appendChild(r),i.onsubmit=function(e){e.preventDefault();e=function(e){for(var t=0;t<e.length;t++)if(e[t].checked)return g.parseInt(e[t].value)}(this.difficulty);t.sudoku.newGame(e)},a.appendChild(i),a.classList.add("menu-1"),a)),l.appendChild(((d=g.document.createElement("div")).appendChild(e("Comprobar",function(){t.sudoku.checkCells(!1,!1)})),d.appendChild(e("Resolver",function(){t.sudoku.resolveGameBoard()})),d.appendChild(e("Guardar",function(){t.sudoku.saveGame()})),d.appendChild(e("Cargar",function(){t.sudoku.loadGame()})),d.classList.add("menu-2"),d)),l.appendChild((n=g.document.createElement("div"),s=g.document.createElement("div"),t.timer=g.document.createElement("span"),t.timer.innerText="00:00:00",s.appendChild(t.timer),n.appendChild(s),n.appendChild(e("Iniciar",function(){t.sudoku.startTimer()})),n.appendChild(e("Pausar",function(){t.sudoku.pauseTimer()})),n.appendChild(e("Reiniciar",function(){t.sudoku.resetTimer()})),n.classList.add("menu-3"),n)),t.container.appendChild(l)},paintTableValues:function(){this.tableValues=g.document.createElement("table");for(var e=g.document.createElement("tr"),t=0;t<10;t++){var a=g.document.createElement("td"),i=g.document.createElement("div"),r=0<t?t.toString():"";i.classList.add("content-values"),i.setAttribute("data-value",r),i.appendChild(g.document.createTextNode(r)),a.classList.add("td-values"),a.appendChild(i),e.appendChild(a)}this.tableValues.classList.add("table-values"),this.tableValues.appendChild(e),this.container.appendChild(this.tableValues)},paintBoard:function(e){var t=g.document.createElement("tbody"),a=0;for(var i,r,d=0;d<e.length;d++){var n=g.document.createElement("tr"),s=0;0<d&&d%3==0&&(a+=3);for(var l=0;l<e[d].length;l++){var o=g.document.createElement("td"),c=g.document.createElement("div"),u=g.Array.isArray(e[d][l]),p=g.isNaN(g.parseInt(e[d][l]))||u?"":g.parseInt(e[d][l]).toString(),m=(l%3==0&&s++,c.classList.add("content"),g.document.createElement("span"));if(m.appendChild(g.document.createTextNode(p)),c.appendChild(m),c.setAttribute("data-x",l.toString()),c.setAttribute("data-y",d.toString()),c.setAttribute("data-group",(a+s).toString()),c.setAttribute("data-value",p),c.setAttribute("tabindex","1"),p&&"number"==typeof e[d][l])c.classList.add("blocked");else if(-1<e[d][l].indexOf("v"))c.classList.add("blocked"),c.classList.add("valid");else{var h=g.document.createElement("div");h.classList.add("content-notes");for(var v=1;v<=9;v++){var f=!1;u&&(f=-1<e[d][l].indexOf(v)),h.appendChild((i=v,f=f,r=void 0,(r=g.document.createElement("div")).setAttribute("data-value",i.toString()),f||(r.style.display="none"),r.classList.add("note"+i),r.appendChild(g.document.createTextNode(i.toString())),r))}u?m.style.display="none":h.style.display="none",c.appendChild(h)}0<d&&d%3==0&&o.classList.add("t-separator"),0<l&&l%3==0&&o.classList.add("l-separator"),o.appendChild(c),n.appendChild(o)}t.appendChild(n)}this.table.innerHTML="",this.table.appendChild(t)},createSelectEvent:function(){var s=this,l=void 0,o=void 0;function t(e){if(s.selectedCell&&s.selectedCell!==e.target&&(s.selectedCell.classList.remove("selected"),l))for(var t=0;t<l.length;t++)s.selectedCell!==l[t]&&l[t].classList.remove("selected-group");if(o)for(var a=0;a<o.length;a++)s.selectedCell!==o[a]&&o[a].classList.remove("selected-values");if(s.selectedCell=e.target,o=l=void 0,-1===s.selectedCell.className.indexOf("content")&&(s.selectedCell=s.selectedCell.parentElement),-1<s.selectedCell.className.indexOf("content-notes")&&(s.selectedCell=s.selectedCell.parentElement),-1!==s.selectedCell.className.indexOf("content")){s.selectedCell.classList.add("selected");var e=s.selectedCell.getAttribute("data-group"),i=s.selectedCell.getAttribute("data-x"),r=s.selectedCell.getAttribute("data-y");if(l=g.document.querySelectorAll("[data-group='"+e+"'], [data-x='"+i+"'], [data-y='"+r+"']"))for(var d=0;d<l.length;d++)s.selectedCell!==l[d]&&l[d].classList.add("selected-group");e=s.selectedCell.getAttribute("data-value");if((o=g.document.querySelectorAll("[data-value='"+e+"']"))&&!s.sudoku.gameOver)for(var n=0;n<o.length;n++)s.selectedCell!==o[n]&&o[n].classList.add("selected-values");s.inputValue.focus()}}this.table.addEventListener("focusin",function(e){t(e)}),this.table.addEventListener("click",function(e){t(e)})},createValueEvent:function(){var r=this;function a(e){if(r.selectedCell&&!(-1<r.selectedCell.className.indexOf("blocked"))){if(r.selectedCell.children[0].style.display||r.selectedCell.getAttribute("data-value")==e){var t,a=!1;if(r.selectedCell.children[0].style.display||r.selectedCell.getAttribute("data-value")!=e||(r.selectedCell.children[0].style.display="none",r.selectedCell.children[1].style.display=""),a=r.selectedCell.children[1].style.display?a:!(t=r.selectedCell.children[1].querySelector("[data-value='"+e+"']"))||(t.style.display=t.style.display?"":"none",0===g.Array.prototype.slice.call(r.selectedCell.children[1].children).filter(function(e){return!e.style.display}).length)){r.selectedCell.children[1].style.display="none",r.selectedCell.children[0].style.display="";for(var i=0;i<r.selectedCell.children[1].children.length;i++)r.selectedCell.children[1].children[i].style.display="none"}r.selectedCell.setAttribute("data-value",""),r.selectedCell.children[0].innerHTML="",r.setGameBoardNote(e)}else r.selectedCell.setAttribute("data-value",e),r.selectedCell.children[0].innerHTML=e,r.setGameBoardValue(e),r.checkGameBoard();r.selectedCell.click()}}function i(e,t){r.selectedCell&&(e=g.parseInt(r.selectedCell.getAttribute("data-x"))+e,t=g.parseInt(r.selectedCell.getAttribute("data-y"))+t,0<=e&&e<9&&0<=t&&t<9&&((e=g.document.querySelector("[data-x='"+e+"'][data-y='"+t+"']"))&&e.click()))}this.tableValues.addEventListener("click",function(e){a(e.target.getAttribute("data-value"))}),this.inputValue.addEventListener("keyup",function(e){var t=e.key.toLowerCase();if(-1<t.indexOf("del")||-1<t.indexOf("back")||"0"===t)a("");else if(g.isNaN(g.parseInt(t)))switch(t=t.replace("arrow","")){case"up":i(0,-1);break;case"left":i(-1,0);break;case"right":i(1,0);break;case"down":i(0,1)}else switch(t){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a(t)}this.value=""})},setGameBoardValue:function(e){var t,a;this.selectedCell&&(t=g.parseInt(this.selectedCell.getAttribute("data-x")),a=g.parseInt(this.selectedCell.getAttribute("data-y")),this.sudoku.gameBoard[a][t]=e)},setGameBoardNote:function(e){var t,a,i;this.selectedCell&&(e=g.parseInt(e),t=g.parseInt(this.selectedCell.getAttribute("data-x")),a=g.parseInt(this.selectedCell.getAttribute("data-y")),g.isNaN(e)?this.sudoku.gameBoard[a][t]="":(g.Array.isArray(this.sudoku.gameBoard[a][t])||(this.sudoku.gameBoard[a][t]=[]),-1===(i=this.sudoku.gameBoard[a][t].indexOf(e))?this.sudoku.gameBoard[a][t].push(e):this.sudoku.gameBoard[a][t].splice(i,1)))},checkGameBoard:function(){this.sudoku.isGameBoardCleared()&&(this.sudoku.pauseTimer(),this.sudoku.checkCells(!0,!1),this.sudoku.gameOver=!0,this.showVictoryPopup(this.sudoku.gameBoardChecked))},setBlockedCell:function(e,t,a,i){e=this.table.querySelector("[data-x='"+e+"'][data-y='"+t+"']");e&&!e.classList.contains("blocked")&&a?(e.classList.add("blocked"),e.classList.add("valid")):!e||e.classList.contains("blocked")||a||(e.classList.add("blocked"),e.classList.add("invalid"),e.children[1].style.display="none",e.children[0].style.display=""),void 0!==i&&(i=g.String(i),e.setAttribute("data-value",i),e.children[0].innerHTML=i)},createPopup:function(){var t=this,e=(t.popup.container=g.document.createElement("div"),t.popup.container.classList.add("modal"),g.document.createElement("div")),a=(t.popup.message=g.document.createElement("div"),t.popup.message.classList.add("message"),e.appendChild(t.popup.message),g.document.createElement("button"));a.innerText="Cerrar",a.addEventListener("click",function(e){t.popup.container.style.display="none"}),e.appendChild(a),t.popup.container.appendChild(e),t.popup.container.style.display="none",t.container.appendChild(t.popup.container)},showVictoryPopup:function(e){var t=(t="<h2>¡Has completado el tablero!</h2>")+("<div class='result'><div>Comprobaciones:</div><div>"+e+"</div></div>")+("<div class='result'><div>Tiempo de juego:</div><div>"+this.timer.innerHTML+"</div></div>");this.popup.message.innerHTML=t,this.popup.container.style.display=""},showMessagePopup:function(e){this.popup.message.innerHTML="<p>"+e+"</p>",this.popup.container.style.display=""},deselectValues:function(){for(var e=this.table.querySelectorAll(".selected-values"),t=0;t<e.length;t++)e[t].classList.remove("selected-values")},setTime:function(e){this.timer.innerHTML!==e&&(this.timer.innerHTML=e)},getSaveElements:function(){var e=g.document.querySelector("[name='difficulty']:checked");return{difficulty:e?e.value:void 0,timer:this.timer.innerHTML}},setDifficulty:function(e){e=g.document.querySelector("[name='difficulty'][value='"+e+"']");e&&(e.checked=!0)}},e.prototype.createBoard=function(){var c=this;function e(e,t,a,i){for(var r=[1,2,3,4,5,6,7,8,9],d=20,n=a;n<i;n++)for(var s=e;s<t;s++){var l=Math.floor(Math.random()*r.length),o=r[l];if(function(e,t){for(var a=0;a<c.board.length;a++)if(c.board[a][e]===t)return;return 1}(s,o)&&function(e,t){for(var a=0;a<c.board[e].length;a++)if(c.board[e][a]===t)return;return 1}(n,o))c.board[n][s]=o,c.gameBoard[n][s]=o,r.splice(l,1),d=20;else if(s--,--d<0)return!1}return!0}c.board=new Array(9),c.gameBoard=new Array(9);for(var t=0;t<c.board.length;t++)c.board[t]=new Array(9),c.gameBoard[t]=new Array(9);for(t=0;t<c.board.length;t+=3)for(var a=0;a<c.board[t].length;a+=3)if(!e(a,a+3,t,t+3)){d=r=i=void 0;for(var i=t,r=t+3,d=i;d<r;d++)c.board[d]=new Array(9),c.gameBoard[d]=new Array(9);a=-3}},e.prototype.emptyGameBoard=function(e){for(var t=0;t<e;t++){var a=Math.floor(9*Math.random()),i=Math.floor(9*Math.random());this.gameBoard[i][a]?this.gameBoard[i][a]="":t--}},e.prototype.newGame=function(e){switch(this.createBoard(),e){case 0:this.emptyGameBoard(40);break;case 1:this.emptyGameBoard(50);break;case 2:this.emptyGameBoard(60);break;default:throw Error("JSudoku -> Es necesario que especifique una dificultad válida para poder jugar.")}this.gameBoardChecked=0,this.gameOver=!1,d.paintBoard(this.gameBoard)},e.prototype.isGameBoardCleared=function(){if(this.gameOver)return!0;for(var e=0;e<this.board.length;e++)for(var t=0;t<this.board[e].length;t++){var a=g.parseInt(this.gameBoard[e][t]);if(g.Array.isArray(this.gameBoard[e][t])||g.isNaN(a)||this.board[e][t]!==a)return!1}return!0},e.prototype.checkCells=function(e,t){if(!this.gameOver){e||this.gameBoardChecked++;for(var a=0;a<this.board.length;a++)for(var i=0;i<this.board[a].length;i++){var r=g.parseInt(this.gameBoard[a][i]);g.Array.isArray(this.gameBoard[a][i])||g.isNaN(r)||this.board[a][i]!==r||"string"!=typeof this.gameBoard[a][i]||-1!==this.gameBoard[a][i].indexOf("v")?t&&(g.Array.isArray(this.gameBoard[a][i])||"string"==typeof this.gameBoard[a][i])&&(d.setBlockedCell(i,a,!1,this.board[a][i]),this.gameBoard[a][i]=this.board[a][i]):(d.setBlockedCell(i,a,!0,void 0),this.gameBoard[a][i]+="v")}}},e.prototype.resolveGameBoard=function(){this.gameOver||(this.pauseTimer(),this.checkCells(!1,!0),this.gameOver=!0,d.deselectValues())},e.prototype.saveGame=function(){var e;this.gameOver?d.showMessagePopup("No es posible guardar la partida cuando ésta ya ha finalizado."):(e={mainMenu:d.getSaveElements(),board:this.board,gameBoard:this.gameBoard,gameBoardChecked:this.gameBoardChecked,timerStartDate:this.timerStartDate,diffDate:new Date},g.localStorage.setItem("jsudoku-game",g.JSON.stringify(e)))},e.prototype.loadGame=function(){var e,t=g.localStorage.getItem("jsudoku-game");t&&(e=(t=g.JSON.parse(t)).timerStartDate?new Date(t.timerStartDate):void 0,this.board=t.board,this.gameBoard=t.gameBoard,this.gameBoardChecked=t.gameBoardChecked,this.timerStartDate=e&&new Date(e.setMilliseconds(new Date-new Date(t.diffDate))),this.timerPauseDate=new Date,d.setTime(t.mainMenu.timer),d.setDifficulty(t.mainMenu.difficulty),this.gameOver=!1,d.paintBoard(this.gameBoard))},e.prototype.startTimer=function(){var i;this.gameOver||((i=this).timerInterval||(i.timerStartDate?i.timerPauseDate&&(i.timerStartDate=new Date(i.timerStartDate.setMilliseconds(new Date-i.timerPauseDate))):i.timerStartDate=new Date,i.timerInterval=g.setInterval(function(){var e=new Date(g.parseFloat(new Date-i.timerStartDate)),t=e.getUTCHours().toLocaleString(void 0,{minimumIntegerDigits:2}),a=e.getUTCMinutes().toLocaleString(void 0,{minimumIntegerDigits:2}),e=e.getUTCSeconds().toLocaleString(void 0,{minimumIntegerDigits:2});d.setTime(t+":"+a+":"+e)},1)))},e.prototype.pauseTimer=function(){this.gameOver||(this.timerPauseDate=new Date,g.clearInterval(this.timerInterval),this.timerInterval=0)},e.prototype.resetTimer=function(){this.gameOver||(g.clearInterval(this.timerInterval),this.timerInterval=0,this.timerStartDate=void 0,this.timerPauseDate=void 0,d.setTime("00:00:00"))},e)}(window);